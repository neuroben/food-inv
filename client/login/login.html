<!DOCTYPE html>
    <html lang="hu">
        <head>
            <meta charset="UTF-8">
            <title>log-in</title>
            <link rel="stylesheet" href="../styles/login-style.css">
        </head>
    <body style="margin-top: -150px;">
        <div class="body-container">
            <form class="form" novalidate>
                <label for="identifier">nickname
                    <input type="text" name="identifier" id="identifier" autocomplete="on" required>
                </label>
                <label for="password">pass
                    <input type="password" name="password" id="password" autocomplete="on" required>
                </label>
                <label id="asd"></label>
                <input type="submit" value="ok">
            </form>

            <script>
                require('dotenv').config();
                const form = document.querySelector('form');



                form.addEventListener('submit', (e) => { // e === event
                    e.preventDefault(); // nem akarunk semmilyen előre beállított működést pl. oldal frissítés
                

                    const formData = new FormData(form);
                    //console.log(formData.get('identifier'));
                    //console.log(formData.get('password'));

                    fetch('https://1337-neuroben-foodinv-inb7p9a3qw8.ws-eu108.gitpod.io/api/auth/local', {
                        method: "POST",
                        body: formData,
                    })
                        .then(res => res.json())   //res === response --> .json() functionnal formázzuk a választ json formátumba
                        .then(data => { 
                        console.log(data);
                        
                            if(data.user.blocked == false && data.user.confirmed == true ){
                                window.location.replace(`${process.env.STRAPI_U}/food/food.html`);
                            } else {
                                console.log('User is either blocked or not confirmed');
                            }
                        });
                    //console.log(res);
                    //.then(res => console.log(res))
                    //.then(res => document.getElementById("asd").innerText = res.body); 
                });
            </script>

        </div>
    </body>
</html>